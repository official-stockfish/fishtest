{% extends "base.html.j2" %}

{% set is_monthly = is_monthly if is_monthly is defined else false %}
{% set monthly_suffix = monthly_suffix if monthly_suffix is defined else "" %}

{% block title %}Contributors{{ monthly_suffix }} | Stockfish Testing{% endblock %}

{% block body %}
<h2> Contributors{{ monthly_suffix }} </h2>

<div class="row g-3 mb-3">
  <div class="col-6 col-sm">
    <div class="card card-lg-sm text-center">
      <div class="card-header text-nowrap" title="Testers">Testers</div>
      <div class="card-body">
        <h4 class="card-title mb-0 monospace">
          {{ summary.testers }}
        </h4>
      </div>
    </div>
  </div>

  <div class="col-6 col-sm">
    <div class="card card-lg-sm text-center">
      <div class="card-header text-nowrap" title="Developers">Developers</div>
      <div class="card-body">
        <h4 class="card-title mb-0 monospace">
          {{ summary.developers }}
        </h4>
      </div>
    </div>
  </div>

  <div class="col-6 col-sm">
    <div class="card card-lg-sm text-center">
      <div class="card-header text-nowrap" title="Active testers">Active testers</div>
      <div class="card-body">
        <h4 class="card-title mb-0 monospace">
          {{ summary.active_testers }}
        </h4>
      </div>
    </div>
  </div>

  <div class="col-6 col-sm">
    <div class="card card-lg-sm text-center">
      <div class="card-header text-nowrap" title="CPU years">CPU years</div>
      <div class="card-body">
        <h4 class="card-title mb-0 monospace">
          {{ "{0:.2f}".format(summary.cpu_hours / (24 * 365)) }}
        </h4>
      </div>
    </div>
  </div>

  <div class="col-6 col-sm">
    <div class="card card-lg-sm text-center">
      <div class="card-header text-nowrap" title="Games played">Games played</div>
      <div class="card-body">
        <h4 class="card-title mb-0 monospace">
          {{ summary.games }}
        </h4>
      </div>
    </div>
  </div>

  <div class="col-6 col-sm">
    <div class="card card-lg-sm text-center">
      <div class="card-header text-nowrap" title="Tests submitted">Tests submitted</div>
      <div class="card-body">
        <h4 class="card-title mb-0 monospace">
          {{ summary.tests }}
        </h4>
      </div>
    </div>
  </div>
</div>

<div class="row g-3 mb-1 align-items-end">
  <div class="col-12 col-md-auto">
    <form method="GET" action="{{ request.url.path }}">
      <label for="search_contributors" class="form-label">Search</label>
      <div class="d-flex align-items-center gap-2">
        <input
          id="search_contributors"
          class="form-control"
          placeholder="Search username"
          type="search"
          name="search"
          value="{{ search }}"
          hx-get="{{ request.url.path }}"
          hx-trigger="input changed delay:300ms"
          hx-target="#contributors_table tbody"
          hx-swap="innerHTML"
          hx-include="this"
          hx-indicator="#contributors-search-indicator"
        >
        <button type="submit" class="btn btn-secondary">Search</button>
        <span id="contributors-search-indicator" class="htmx-indicator small text-muted">Searching...</span>
      </div>
    </form>
  </div>
</div>

<div class="table-responsive-lg">
  <table id="contributors_table" class="table table-striped table-sm">
    <thead class="sticky-top">
      <tr>
        <th></th>
        <th>Username</th>
        <th class="text-end">Last active</th>
        <th class="text-end">Games/Hour</th>
        <th class="text-end">CPU Hours</th>
        <th class="text-end">Games played</th>
        <th class="text-end">Tests submitted</th>
        <th>Tests repository</th>
      </tr>
    </thead>
    <tbody>
      {% include "contributors_rows_fragment.html.j2" %}
    </tbody>
  </table>
</div>

{% endblock %}
