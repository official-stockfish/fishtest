{% extends "base.html.j2" %}

{% block title %}Workers Management | Stockfish Testing{% endblock %}

{% block body %}
<h2>Workers Management</h2>

{% if show_admin %}
  <h3>{{ worker_name }}</h3>
  <form method="POST">
    <div class="mb-3">Last changed: {{ last_updated_label }}</div>
    <div class="mb-3">
      <label for="messageInput" class="form-label">Issue</label>
      <textarea
        id="messageInput"
        rows="4" class="form-control"
        placeholder="Describe the issue here" name="message"
      >{{ message }}</textarea>
    </div>
    <div class="mb-3 form-check">
      <label class="form-check-label" for="blockWorker">Blocked</label>
      <input
        type="checkbox"
        class="form-check-input"
        id="blockWorker"
        name="blocked" {{ "checked" if blocked else "" }}
      >
    </div>
    <button
      type="submit"
      name="submit"
      value="Submit"
      class="btn btn-primary"
    >Submit</button>
    <button type="submit" name="submit" class="btn btn-secondary">Cancel</button>
  </form>
  <hr>
{% endif %}

<h3>Blocked workers</h3>

<div id="workers-table-handler" class="dropdown">
  {% set workers_filter_label = "Modified &#8804; 5 days ago" %}
  {% if filter_value == "all-workers" %}
    {% set workers_filter_label = "All" %}
  {% elif filter_value == "gt-5days" %}
    {% set workers_filter_label = "Modified &gt; 5 days ago" %}
  {% endif %}
  <button
    id="workers-table-toggle"
    class="btn btn-secondary dropdown-toggle"
    type="button"
    data-bs-toggle="dropdown"
    aria-expanded="false"
  >{{ workers_filter_label | safe }}</button>

  <span id="workers-filter-indicator" class="htmx-indicator small text-muted ms-2">Filtering...</span>

  <ul class="dropdown-menu">
    <li>
      <a
        class="dropdown-item"
        href="{{ request.url.path }}?filter=all-workers"
        hx-get="{{ request.url.path }}?filter=all-workers"
        hx-target="#workers-table tbody"
        hx-swap="innerHTML"
        hx-indicator="#workers-filter-indicator"
      >All</a>
    </li>
    <li>
      <a
        class="dropdown-item"
        href="{{ request.url.path }}?filter=le-5days"
        hx-get="{{ request.url.path }}?filter=le-5days"
        hx-target="#workers-table tbody"
        hx-swap="innerHTML"
        hx-indicator="#workers-filter-indicator"
      >Modified &#8804; 5 days ago</a>
    </li>
    <li>
      <a
        class="dropdown-item"
        href="{{ request.url.path }}?filter=gt-5days"
        hx-get="{{ request.url.path }}?filter=gt-5days"
        hx-target="#workers-table tbody"
        hx-swap="innerHTML"
        hx-indicator="#workers-filter-indicator"
      >Modified &gt; 5 days ago</a>
    </li>
  </ul>
</div>

<table id="workers-table" class="table table-striped table-sm">
  <thead>
    <tr>
      <th>Worker</th>
      <th>Last changed</th>
      <th>Events</th>
      {% if show_email %}
        <th>Email</th>
      {% endif %}
    </tr>
  </thead>
  <tbody>
    {% include "workers_rows_fragment.html.j2" %}
  </tbody>
</table>
{% endblock %}
