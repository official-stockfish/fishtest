{% extends "base.html.j2" %}

{% block title %}User Management | Stockfish Testing{% endblock %}

{% block body %}
<h2>User Management</h2>

<div class="mw-xxl">
  <div class="row g-3 mb-3">
    <div class="col-6 col-sm">
      <div class="card card-lg-sm text-center">
        <div class="card-header text-nowrap" title="All Users">All</div>
        <div class="card-body">
          <h4 class="card-title mb-0 monospace">{{ all_count }}</h4>
        </div>
      </div>
    </div>
    <div class="col-6 col-sm">
      <div class="card card-lg-sm text-center">
        <div class="card-header text-nowrap" title="Pending Users">Pending</div>
        <div class="card-body">
          <h4 class="card-title mb-0 monospace">{{ pending_count }}</h4>
        </div>
      </div>
    </div>
    <div class="col-6 col-sm">
      <div class="card card-lg-sm text-center">
        <div class="card-header text-nowrap" title="Blocked users">Blocked</div>
        <div class="card-body">
          <h4 class="card-title mb-0 monospace">{{ blocked_count }}</h4>
        </div>
      </div>
    </div>
    <div class="col-6 col-sm">
      <div class="card card-lg-sm text-center">
        <div class="card-header text-nowrap" title="Idle Users">Idle</div>
        <div class="card-body">
          <h4 class="card-title mb-0 monospace">{{ idle_count }}</h4>
        </div>
      </div>
    </div>
    <div class="col-6 col-sm">
      <div class="card card-lg-sm text-center">
        <div class="card-header text-nowrap" title="Approver Users">Approvers</div>
        <div class="card-body">
          <h4 class="card-title mb-0 monospace">{{ approvers_count }}</h4>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="users-table-handler" class="dropdown">
  {% set users_group_label = "Pending" %}
  {% if group == "pending" %}
    {% set users_group_label = "Pending" %}
  {% elif group == "blocked" %}
    {% set users_group_label = "Blocked" %}
  {% elif group == "idle" %}
    {% set users_group_label = "Idle" %}
  {% elif group == "approvers" %}
    {% set users_group_label = "Approvers" %}
  {% endif %}
  <button
    id="users-table-toggle"
    class="btn btn-secondary dropdown-toggle"
    type="button"
    data-bs-toggle="dropdown"
    aria-expanded="false"
  >{{ users_group_label }}</button>

  <span id="users-filter-indicator" class="htmx-indicator small text-muted ms-2">Loading...</span>

  <ul class="dropdown-menu">
    <li>
      <a
        class="dropdown-item"
        href="/user_management?group=all"
        hx-get="/user_management?group=all"
        hx-target="#users-table tbody"
        hx-swap="innerHTML"
        hx-indicator="#users-filter-indicator"
      >All</a>
    </li>
    <li>
      <a
        class="dropdown-item"
        href="/user_management?group=pending"
        hx-get="/user_management?group=pending"
        hx-target="#users-table tbody"
        hx-swap="innerHTML"
        hx-indicator="#users-filter-indicator"
      >Pending</a>
    </li>
    <li>
      <a
        class="dropdown-item"
        href="/user_management?group=blocked"
        hx-get="/user_management?group=blocked"
        hx-target="#users-table tbody"
        hx-swap="innerHTML"
        hx-indicator="#users-filter-indicator"
      >Blocked</a>
    </li>
    <li>
      <a
        class="dropdown-item"
        href="/user_management?group=idle"
        hx-get="/user_management?group=idle"
        hx-target="#users-table tbody"
        hx-swap="innerHTML"
        hx-indicator="#users-filter-indicator"
      >Idle</a>
    </li>
    <li>
      <a
        class="dropdown-item"
        href="/user_management?group=approvers"
        hx-get="/user_management?group=approvers"
        hx-target="#users-table tbody"
        hx-swap="innerHTML"
        hx-indicator="#users-filter-indicator"
      >Approvers</a>
    </li>
  </ul>
</div>

<table id="users-table" class="table table-striped table-sm">
  <thead>
    <tr>
      <th style="width:20%">Username</th>
      <th style="width:20%">Registration Time</th>
      <th style="width:20%">Groups</th>
      <th style="width:40%">Email</th>
    </tr>
  </thead>
  <tbody>
    {% include "user_management_rows_fragment.html.j2" %}
  </tbody>
</table>
{% endblock %}
